import numpy as np
from sklearn.preprocessing import PolynomialFeatures
from sklearn.linear_model import LinearRegression
from sklearn.kernel_ridge import KernelRidge
from sklearn.preprocessing import StandardScaler

import matplotlib.pyplot as plt
import json
import datetime


plain_str = """{"status":"success","uuuu":false,"data":{"rrrrr":"xxxx","result":[{"eeee":{"dddd":"t1"},"values":[[1663567200,"681914.06"],[1663574400,"608808.02"],[1663581600,"627014.02"],[1663588800,"640231.09"],[1663596000,"677550.28"],[1663603200,"582179.99"],[1663610400,"515123.3300000001"],[1663617600,"527273.3899999999"],[1663624800,"518777.13000000006"],[1663632000,"668148.73"],[1663639200,"717654.52"],[1663646400,"838883.6"],[1663653600,"741757.04"],[1663660800,"576192.17"],[1663668000,"568671.14"],[1663675200,"543011.97"],[1663682400,"528993.25"],[1663689600,"486738.01"],[1663696800,"463145.03"],[1663704000,"462612.81999999995"],[1663711200,"452894"],[1663718400,"798961.67"],[1663725600,"708038.79"],[1663732800,"750552.99"],[1663740000,"607109.99"],[1663747200,"541789.5800000001"],[1663754400,"621187.84"],[1663761600,"544977.6"],[1663768800,"576966.27"],[1663776000,"611054.46"],[1663783200,"494693.31000000006"],[1663790400,"491699.43000000005"],[1663797600,"444554"],[1663804800,"781944.28"],[1663812000,"745777.5999999999"],[1663819200,"708029.8300000001"],[1663826400,"640105.03"],[1663833600,"652328.98"],[1663840800,"640141.75"],[1663848000,"611092.55"],[1663855200,"539857.57"],[1663862400,"489960.93000000005"],[1663869600,"494013.37"],[1663876800,"425572.67"],[1663884000,"390074.18999999994"],[1663891200,"692822.5700000001"],[1663898400,"723680.96"],[1663905600,"729287.1399999999"],[1663912800,"659668.46"],[1663920000,"622904.6"],[1663927200,"603375.8099999999"],[1663934400,"585331.05"],[1663941600,"377781.58999999997"],[1663948800,"665926.83"],[1663956000,"482728.3"],[1663963200,"458859.97000000003"],[1663970400,"445997.05"],[1663977600,"629984.4099999999"],[1663984800,"598581.85"],[1663992000,"656199.47"],[1663999200,"676448.4299999999"],[1664006400,"678805.95"],[1664013600,"522826.07"],[1664020800,"516692.97"],[1664028000,"533604.5700000001"],[1664035200,"489109.37"],[1664042400,"442513.85000000003"],[1664049600,"358332.82"],[1664056800,"348656.95999999996"],[1664064000,"739488.4"],[1664071200,"641892.96"],[1664078400,"787613.79"],[1664085600,"748493.4600000001"],[1664092800,"685861.99"],[1664100000,"555306.03"],[1664107200,"536956.2"],[1664114400,"540681.1499999999"],[1664121600,"501159.41000000003"],[1664128800,"438721.57999999996"],[1664136000,"358965.67"],[1664143200,"390505.35000000003"],[1664150400,"691972.85"],[1664157600,"755264.49"],[1664164800,"786643.11"],[1664172000,"675829.22"],[1664179200,"650897.4299999999"],[1664186400,"563179.71"],[1664193600,"547885.64"],[1664200800,"547902.3"],[1664208000,"508834.21"],[1664215200,"484876.29000000004"],[1664222400,"497793.17000000004"],[1664229600,"463370.44"],[1664236800,"845871.5"],[1664244000,"808902.53"],[1664251200,"858454.08"],[1664258400,"634879.17"],[1664265600,"611680.06"],[1664272800,"528901.34"],[1664280000,"546941.55"],[1664287200,"527999.81"],[1664294400,"524679.4299999999"],[1664301600,"460084.86"],[1664308800,"437186.01"],[1664316000,"456432.78"],[1664323200,"704807.54"],[1664330400,"749894.6000000001"],[1664337600,"801859.12"],[1664344800,"657133.6"],[1664352000,"548587.17"],[1664359200,"531565.1499999999"],[1664366400,"539869.86"],[1664373600,"527325.5700000001"],[1664380800,"532088.91"],[1664388000,"435023.37"],[1664395200,"441996.96"],[1664402400,"485215.44999999995"],[1664409600,"814555.9099999999"],[1664416800,"817513.6499999999"],[1664424000,"830804.77"],[1664431200,"595436.87"],[1664438400,"545386.12"],[1664445600,"491790.63999999996"],[1664452800,"492424.85"],[1664460000,"489593.52"],[1664467200,"516172.68000000005"],[1664474400,"388562.98"],[1664481600,"400203.89"],[1664488800,"479711.33999999997"],[1664496000,"737589.77"],[1664503200,"715033.44"],[1664510400,"703770.52"],[1664517600,"546709.49"],[1664524800,"579075.8300000001"],[1664532000,"528615.22"],[1664539200,"649671.14"],[1664546400,"241282.66"],[1664553600,"469503.92000000004"],[1664560800,"396082.67000000004"],[1664568000,"448741.88"],[1664575200,"484758.02"],[1664582400,"668986.38"],[1664589600,"649076.78"],[1664596800,"714370.4299999999"],[1664604000,"674692.52"],[1664611200,"592498.05"],[1664618400,"513033.53"],[1664625600,"525154.92"],[1664632800,"397349.86"],[1664640000,"656147.38"],[1664647200,"408596.68"],[1664654400,"439858.20999999996"],[1664661600,"442388.27999999997"],[1664668800,"683697.53"],[1664676000,"708822.74"],[1664683200,"737436.72"],[1664690400,"664169.5"],[1664697600,"593873.81"],[1664704800,"504811.17000000004"],[1664712000,"509463.42999999993"],[1664719200,"447227.73999999993"],[1664726400,"699273.27"],[1664733600,"425175.80999999994"],[1664740800,"425305.36"],[1664748000,"453098.81"],[1664755200,"756763.4"],[1664762400,"705389.21"],[1664769600,"721877.36"],[1664776800,"670210.73"],[1664784000,"512021.87999999995"],[1664791200,"489491.81999999995"],[1664798400,"492947.17000000004"],[1664805600,"408502.56"],[1664812800,"612942.74"],[1664820000,"384834.19"],[1664827200,"433624.06"],[1664834400,"484727.59"],[1664841600,"654070.1699999999"],[1664848800,"645984.86"],[1664856000,"586331.9199999999"],[1664863200,"657954.17"],[1664870400,"461379.39"],[1664877600,"466127.20999999996"],[1664884800,"505665.11"],[1664892000,"418300.42000000004"],[1664899200,"458641.06999999995"],[1664906400,"410590.02"],[1664913600,"418862.29000000004"],[1664920800,"422715.4"],[1664928000,"700889.1399999999"],[1664935200,"700171.5700000001"],[1664942400,"734121.9199999999"],[1664949600,"654910.8"],[1664956800,"512112.82000000007"],[1664964000,"473307.31000000006"],[1664971200,"517896.29000000004"],[1664978400,"461624.91"],[1664985600,"506578.18000000005"],[1664992800,"424275.15"],[1665000000,"423052.95999999996"],[1665007200,"462213.6"],[1665014400,"705215.13"],[1665021600,"560105.8"],[1665028800,"503841.5"],[1665036000,"500412.49"],[1665043200,"505829.15"],[1665050400,"487779.93000000005"],[1665057600,"482704.26"],[1665064800,"420956.22000000003"],[1665072000,"564547.77"],[1665079200,"427415.83"],[1665086400,"434703.32"],[1665093600,"469739.09"],[1665100800,"675041.8"],[1665108000,"675331.03"],[1665115200,"688991.9400000001"],[1665122400,"675518.6200000001"],[1665129600,"595474.26"],[1665136800,"475059.25000000006"],[1665144000,"473888.68"],[1665151200,"485069.41000000003"],[1665158400,"501453.81999999995"],[1665165600,"404732.42000000004"],[1665172800,"441308.97"],[1665180000,"470006.11"],[1665187200,"707034.9"],[1665194400,"664112.28"],[1665201600,"693697.3300000001"],[1665208800,"750320.08"],[1665216000,"514951.20999999996"],[1665223200,"494651.76999999996"],[1665230400,"525358.02"],[1665237600,"491452.4199999999"],[1665244800,"500723.12"],[1665252000,"407697.9"],[1665259200,"486235.02"],[1665266400,"524335.04"],[1665273600,"767268.1900000001"],[1665280800,"799126.1499999999"],[1665288000,"731790.75"],[1665295200,"578209.81"],[1665302400,"548791.8200000001"],[1665309600,"508394.05"],[1665316800,"502272.2"],[1665324000,"491835.27"],[1665331200,"481037.7"],[1665338400,"434133.81"],[1665345600,"438872.77"],[1665352800,"516521.07000000007"],[1665360000,"730639.54"],[1665367200,"721640.9199999999"],[1665374400,"766991.87"],[1665381600,"655909.3600000001"],[1665388800,"565258.53"],[1665396000,"486164.99"],[1665403200,"487714.36"],[1665410400,"498467.08999999997"],[1665417600,"507720.78"],[1665424800,"566911.16"],[1665432000,"530288.7"],[1665439200,"635286.19"],[1665446400,"816696.5700000001"],[1665453600,"692763.1799999999"],[1665460800,"674527.02"],[1665468000,"685792.45"],[1665475200,"503192.73"],[1665482400,"497489.86"],[1665489600,"497389.52999999997"],[1665496800,"560881.97"],[1665504000,"591360.5900000001"],[1665511200,"556066.96"],[1665518400,"579862.5700000001"],[1665525600,"619398.9099999999"],[1665532800,"772361.34"],[1665540000,"827634.87"],[1665547200,"882072.2899999999"],[1665554400,"758376.42"],[1665561600,"742601.61"],[1665568800,"534228.56"],[1665576000,"510311.5"],[1665583200,"559065.96"],[1665590400,"542879.53"],[1665597600,"488430.7200000001"],[1665604800,"493019.66"],[1665612000,"602364.88"],[1665619200,"842132.33"],[1665626400,"809247.97"],[1665633600,"775519.1100000001"],[1665640800,"616029.47"],[1665648000,"570449.54"],[1665655200,"545680.52"],[1665662400,"602483.79"],[1665669600,"544708.9299999999"],[1665676800,"546226.9299999999"],[1665684000,"496554"],[1665691200,"471212.72"],[1665698400,"571080.81"],[1665705600,"828813.0700000001"],[1665712800,"826414.21"],[1665720000,"818583.8400000001"],[1665727200,"596700.55"],[1665734400,"551559.18"],[1665741600,"507816.36"],[1665748800,"466215.72"],[1665756000,"441500.81999999995"],[1665763200,"694396.3500000001"],[1665770400,"501098.37"],[1665777600,"437577.97000000003"],[1665784800,"467999.1"],[1665792000,"781699.46"],[1665799200,"814739.12"],[1665806400,"753855.4099999999"],[1665813600,"571518.95"],[1665820800,"544868.89"],[1665828000,"547542.8"],[1665835200,"536448.41"],[1665842400,"419030.64"],[1665849600,"588147.0599999999"],[1665856800,"465877.38"],[1665864000,"455071.44999999995"],[1665871200,"520001.79"],[1665878400,"728889.04"],[1665885600,"732710.68"],[1665892800,"775626.25"],[1665900000,"542881.27"],[1665907200,"499772.57999999996"],[1665914400,"528717.79"],[1665921600,"500092.56"],[1665928800,"479280.22000000003"],[1665936000,"506473.14"],[1665943200,"490986.43"],[1665950400,"475796.51"],[1665957600,"507291.06999999995"],[1665964800,"810729.6399999999"],[1665972000,"777308.8200000001"],[1665979200,"583770.08"],[1665986400,"609039.56"],[1665993600,"513075.95999999996"],[1666000800,"527940.3099999999"],[1666008000,"537095.14"],[1666015200,"484173.11"],[1666022400,"504547.62"],[1666029600,"481987.02"],[1666036800,"494746.15"],[1666044000,"521224.17000000004"],[1666051200,"788051.4199999999"],[1666058400,"663897.92"],[1666065600,"817648.51"],[1666072800,"591276.25"],[1666080000,"590589.93"],[1666087200,"554269.61"],[1666094400,"591351.9199999999"],[1666101600,"515565.12000000005"],[1666108800,"544231.34"],[1666116000,"481881.28"],[1666123200,"490855.46"],[1666130400,"518614.56999999995"],[1666137600,"627069.6"],[1666144800,"628965.03"],[1666152000,"802946.19"],[1666159200,"656075.54"]]}]}}"""
data_dict = json.loads(plain_str)
xtotal = []
ytotal = []
for i in range(0, int (len(data_dict["data"]["result"][0]["values"]))):
    time = datetime.datetime.fromtimestamp(int(data_dict["data"]["result"][0]["values"][i][0]))
    tmp = []
    #tmp.append(time.day)
    tmp.append(time.hour)
    tmp.append(time.minute)
    xtotal.append(tmp)
    ytotal.append(float(data_dict["data"]["result"][0]["values"][i][1]))
# 上面是数据获取，获取完 数据是 x[10001,12222,12223] 这种时间戳， y[1213.11,2311231.22,1213,22] 这种值


train_quntity = int(len(xtotal)* (8 / 9)) - 1
xtrain = xtotal[0:train_quntity]
ytrain = ytotal[0:train_quntity]
# print(xtrain)
xtest = xtotal[train_quntity + 1:]
ytest = ytotal[train_quntity + 1:]
#print(xtest)
clf = KernelRidge(alpha=1, kernel='rbf', gamma=5 ** -2)
clf.fit(xtrain, ytrain)

y_pred_ = clf.predict(xtest)

plt.plot(y_pred_, c = 'red')
plt.plot(ytest, c = 'blue')
plt.show()

##poly = PolynomialFeatures(degree=3, interaction_only=False, include_bias=False)

# #x_ = poly.fit_transform(x)

# clf.fit(x, y)
# # linear = LinearRegression()
# # linear.fit(x_, y)
# y_pred_ = clf.predict(x)
# # print(linear.get_params())
# # print(linear.coef_)
# plt.plot(xtotal, ytotal, c='blue')

# newxtotal = np.reshape( (-1, 1))
# plt.plot(newxtotal, y_pred_, c='red')
# plt.show()
